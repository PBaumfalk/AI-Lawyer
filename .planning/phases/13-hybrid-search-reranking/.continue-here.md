---
phase: 13-hybrid-search-reranking
task: planning-session
status: paused
last_updated: 2026-02-27T00:14:54.355Z
---

<current_state>
Session war kein Phase-Execution, sondern eine intensive Planning- und Todo-Capture-Session.
Zusätzlich wurden direkte Code-Änderungen an Helenas System Prompt vorgenommen.
Nächster logischer Schritt: /gsd:new-milestone um die 16 gesammelten Todos in eine strukturierte Roadmap zu überführen.
</current_state>

<completed_work>

## Todos angelegt (16 gesamt)

### Helena Knowledge Infrastructure
1. `improve-helena-rag-pipeline-with-hybrid-search-and-reranking` — Hybrid Search + Reranking + Parent-Child Chunking
2. `gesetze-rag-für-helena-und-normen-verknüpfung-an-akten` — Bundesgesetze via bundestag/gesetze-Repo, pgvector, Normen-Verknüpfung in Akte-UI
3. `urteile-rag-für-helena-mit-pii-filter-und-quellen-ingestion` — BMJ/Open Legal Data/BAG-RSS, PII-Filter Pflicht
4. `arbeitswissen-rag-für-helena-formulare-muster-kosten-erv` — Formulare, Muster, GKG/RVG-Regeln, ERV-Validator
5. `helena-orchestrator-und-schriftsatz-output-schema` — ReAct Agent-Loop, Schriftsatz-JSON-Schema, Platzhalter-Standard
6. `helena-qa-gates-und-audit-trail` — Goldset, Recall@k, Halluzinationsrate, Retrieval-Log
7. `helena-autonomer-agent-loop-tools-taskliste-draft-approval` — **Herzstück**: @-Tagging, BullMQ-Jobs, Tool-Set, Draft-Approval-Workflow, Background-Scanner, Alert-System

### J-Lawyer Migration
8. `j-lawyer-migration-akten-beteiligte-dokumente-kalender` — REST API Export, ETL Node.js-Skript, MinIO-Dokumente, idempotent mit jlawyer_id

### Auth
9. `2fa-login-totp-authenticator-app` — TOTP via otplib, QR-Code, Backup-Codes, NextAuth v5 Integration

### Akte-Detail UX
10. `quick-wins-akte-detail-empty-states-ocr-kpi-navigation` — KPI-Cards navigierbar, OCR Recovery-Banner, Empty States mit CTAs
11. `akte-detail-feed-umbau-composer-und-tab-reduktion` — Historie→Aktivitäten als Default, Filterchips, Composer, 11→4 Tabs, AktenEvent-Tabelle

### Business Intelligence
12. `bi-dashboard-geschaeftskennzahlen` (aus vorheriger Session)
13. `export-csv-xlsx-akten-kontakte-finanzen` (aus vorheriger Session)
14. `falldatenblaetter-per-rechtsgebiet-feldschemas` (aus vorheriger Session)

### Gamification
15. `gamification-kanzlei-steuerung-quests-xp-bossfight-fantasy` — Daily/Weekly/Special Quests, Runen, Streaks, Bossfight "Backlog-Monster", 4 Klassen (Jurist/Schreiber/Wächter/Quartiermeister), Anti-Missbrauch

### Helena Voice
16. `helena-spracheingabe-whisper-und-sprachausgabe-tts` — Mic-Button + OpenAI Whisper, TTS nova-Stimme, Auto-Play Toggle

## Code-Änderungen (committed)

### `src/app/api/ki-chat/route.ts`
- Helena System Prompt komplett neu geschrieben:
  - Roboterhafter Disclaimer entfernt ("Hinweis: Dieser Assistent ersetzt keine anwaltliche Prüfung")
  - NO_SOURCES_INSTRUCTION bereinigt
  - Vollständige Persönlichkeit: 12 Kern-Regeln, Ship-it-Prinzip, Kämpferin-Modus, Beschwerde-Workflow
  - Schwierigkeits-Ampel ROT/GELB/GRÜN mit konkreten Triggern
  - MANDANTEN-MODUS vs. KANZLEI-MODUS (gleicher Charakter, unterschiedliche Offenheit)
  - Hard Limits als eigener Abschnitt (nie direkt versenden, nie löschen, alles ENTWURF)
  - Pferde-Note (sparsam)

</completed_work>

<remaining_work>

- Keinen aktiven Phase-Execution-Stand — alle Todos sind in `.planning/todos/pending/`
- Phase 13 (hybrid-search-reranking) hat PLAN.md-Dateien aber keinen Execution-Stand
- Nächster Schritt: `/gsd:new-milestone` um Todos in strukturierte Milestone-Roadmap zu überführen

</remaining_work>

<decisions_made>

- Helena ist kein Chatbot mit RAG-Kontext, sondern ein autonomer Background-Agent (Todo angelegt)
- J-Lawyer Migration via REST API (nicht direktes DB-Dump) — Swagger-Check vor Implementierung nötig
- Gamification: nicht 6 neue Todos sondern 2 konsolidiert (Orchestrator + QA-Gates) — plus Gamification als eigenes Feature
- Item-Shop für Gamification: Phase 2 (nicht MVP)
- Helena Voice: Whisper (Input) + OpenAI TTS nova (Output)
- Gesetze-RAG und Urteile-RAG: separate DB-Tabellen (law_chunks / urteil_chunks), nicht in document_chunks
- Kostenwissen: deterministisch als JSON/Regelwerk, kein Vektor-Embedding

</decisions_made>

<blockers>

- J-Lawyer Swagger-UI auf laufender Instanz prüfen (5-Min-Check) — bestimmt ob alle Felder via API verfügbar
- Helena Agent-Loop braucht alle 4 Wissensquellen als Voraussetzung (blockiert durch Gesetze/Urteile/Muster/Kosten-RAG)

</blockers>

<context>
Intensive Planungs-Session: Nutzer hat eine Reihe von Feature-Ideen und Konzepte geteilt (RAG-Strategie für Gesetze/Urteile/Arbeitswissen, Helena-Persönlichkeit, Akte-UX-Redesign, Gamification, J-Lawyer-Migration). Alles als strukturierte Todos gesichert.

Helena hat jetzt eine vollständige Persönlichkeit im System Prompt — direkt live ohne Neustart.

Die 16 Todos bilden zusammen zwei natürliche Gruppen:
1. Helena Knowledge + Agent Infrastructure (7 Todos, starke Abhängigkeitskette)
2. Product Features (9 Todos, weitgehend unabhängig voneinander)

Empfehlung: /gsd:new-milestone starten um Prioritäten und Phasen festzulegen.
</context>

<next_action>
Start with: `/gsd:new-milestone` — 16 offene Todos in strukturierte Roadmap überführen.
Oder direkter Einstieg: `/gsd:check-todos` zum Überblick, dann einzelnen Todo zur Implementierung auswählen.
</next_action>
