---
phase: 11-glass-ui-migration
plan: 02
type: execute
wave: 2
depends_on:
  - 11-01
files_modified:
  - src/components/layout/sidebar.tsx
  - src/components/layout/header.tsx
  - src/app/(dashboard)/layout.tsx
autonomous: true
requirements:
  - UI-01
  - UI-02
  - UI-03

must_haves:
  truths:
    - "Sidebar uses glass-sidebar (backdrop-blur 40px, transparent) instead of dark bg-slate-900"
    - "Sidebar width animates with Motion/React spring (240px expanded / 56px collapsed)"
    - "Active nav item shows brand-blue left border + blue-tinted background"
    - "Dark mode toggle (Sun/Moon icon) appears above profile chip in sidebar bottom"
    - "Profile chip shows user initials avatar + display name + logout icon"
    - "Logo area uses glass-panel-elevated chip container (rounded-[10px])"
    - "Admin section has oklch separator line + ADMINISTRATION caps label"
    - "Header is sticky glass-panel with backdrop-blur 24px and 1px border-bottom"
    - "Sidebar text color adapts: near-black in light mode, near-white in dark mode"
    - "Collapsed sidebar (56px) shows icons only with tooltip on hover"
  artifacts:
    - path: "src/components/layout/sidebar.tsx"
      provides: "Glass sidebar — Motion animated width, glass-sidebar class, dark mode toggle, profile chip, active state brand-blue"
    - path: "src/components/layout/header.tsx"
      provides: "Sticky glass-panel header with backdrop-blur 24px"
    - path: "src/app/(dashboard)/layout.tsx"
      provides: "Dashboard shell — body transparent background, sidebar + header + main layout"
  key_links:
    - from: "src/components/layout/sidebar.tsx"
      to: "useTheme() from theme-provider"
      via: "import and setTheme call on dark mode toggle"
      pattern: "useTheme"
    - from: "src/app/(dashboard)/layout.tsx"
      to: "src/components/layout/sidebar.tsx"
      via: "renders <Sidebar /> in flex layout"
      pattern: "<Sidebar"
---

<objective>
Migrate the layout shell to glass design: sidebar gets glass-sidebar treatment with Motion/React animated collapse, dark mode toggle, and profile chip. Header becomes sticky glass-panel. Dashboard layout background becomes transparent so gradient mesh shows through.

Purpose: The layout shell is what users see on every page. It's the visual frame of the entire app. This is the highest-impact change of the whole phase.
Output: Animated glass sidebar with dark mode toggle + profile chip. Sticky glass header. Transparent main layout.
</objective>

<execution_context>
@/Users/patrickbaumfalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrickbaumfalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/11-glass-ui-migration/11-CONTEXT.md
@.planning/phases/11-glass-ui-migration/11-01-SUMMARY.md

<interfaces>
<!-- Current sidebar.tsx (src/components/layout/sidebar.tsx): -->
<!-- - bg-slate-900/85 backdrop-blur-xl border-r — REPLACE with glass-sidebar class -->
<!-- - w-64 / w-16 toggle via CSS classes — REPLACE with Motion animated width -->
<!-- - text-white color — REPLACE with oklch(20% 0.01 250) light / oklch(92% 0.005 250) dark -->
<!-- - Active: bg-white/[0.12] — REPLACE with oklch(45% 0.2 260 / 0.15) + border-left -->
<!-- - Bottom: signOut button — REPLACE with profile chip + dark mode toggle above it -->
<!-- - No animation on collapse — ADD Motion spring stiffness: 300, damping: 30 -->
<!-- - TimerSidebarWidget embedded — KEEP as-is in glass-card chip -->

<!-- Current header.tsx: -->
<!-- - Already uses glass-heavy class — upgrade to explicit glass-panel + sticky positioning -->
<!-- - h-16 — keep height -->

<!-- Current dashboard layout.tsx: -->
<!-- - <div className="flex h-screen overflow-hidden bg-mesh"> — remove bg-mesh, body gradient does the job -->

<!-- ThemeProvider exports (from Plan 01): -->
<!-- useTheme() → { theme, resolvedTheme, setTheme } -->
<!-- Import from: "@/components/providers/theme-provider" -->

<!-- Motion/React API (from Plan 01 install): -->
<!-- import { motion, useReducedMotion } from "motion/react" -->
<!-- <motion.aside animate={{ width: collapsed ? 56 : 240 }} transition={{ type: "spring", stiffness: 300, damping: 30 }} /> -->
<!-- <motion.span initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 0.15 }} /> -->
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate sidebar to glass-sidebar with Motion and dark mode toggle</name>
  <files>src/components/layout/sidebar.tsx</files>
  <action>
    Complete rewrite of sidebar.tsx. Keep all existing imports (Link, usePathname, lucide icons, useSession, TimerSidebarWidget, UserRole types). Add new imports:
    - `import { motion, useReducedMotion } from "motion/react"`
    - `import { Sun, Moon } from "lucide-react"` (already imported as part of lucide set likely — add if missing)
    - `import { useTheme } from "@/components/providers/theme-provider"`

    **Structure:**

    Replace `<aside>` with `<motion.aside>`:
    - Add `@ts-expect-error -- motion v11 + React 19 type mismatch (runtime works fine)` comment before the element (same pattern as GVZ-Claude reference)
    - `animate={{ width: collapsed ? 56 : 240 }}`
    - `transition={prefersReducedMotion ? { duration: 0 } : { type: "spring", stiffness: 300, damping: 30 }}`
    - CSS classes: `"glass-sidebar flex flex-col h-screen select-none overflow-hidden"`
    - Text color: `"text-[oklch(20%_0.01_250)] dark:text-[oklch(92%_0.005_250)]"`

    **Logo area (replaces old header div):**
    ```tsx
    <div className="flex items-center gap-2 px-3 py-4">
      <div className="flex items-center gap-2 px-2 py-1.5 rounded-[10px] bg-white/15 backdrop-blur-[8px] min-w-0">
        <div className="flex-shrink-0 w-7 h-7 bg-[oklch(45%_0.2_260)] rounded-lg flex items-center justify-center shadow-lg">
          <Scale className="w-3.5 h-3.5 text-white" />
        </div>
        {!collapsed && (
          <motion.span
            className="font-semibold text-sm truncate"
            initial={prefersReducedMotion ? false : { opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ duration: 0.15 }}
          >
            AI-Lawyer
          </motion.span>
        )}
      </div>
      <button
        onClick={() => setCollapsed(!collapsed)}
        className="ml-auto p-1.5 rounded-lg hover:bg-white/10 dark:hover:bg-white/5 transition-colors flex-shrink-0"
        aria-label={collapsed ? "Sidebar aufklappen" : "Sidebar einklappen"}
      >
        <ChevronLeft className={cn("w-4 h-4 transition-transform", collapsed && "rotate-180")} />
      </button>
    </div>
    ```

    **Nav items — active state:**
    Replace active class from `bg-white/[0.12] text-white` to:
    ```
    "bg-[oklch(45%_0.2_260/0.15)] text-[oklch(45%_0.2_260)] border-l-2 border-[oklch(45%_0.2_260)] -ml-[2px]"
    ```
    Inactive: `"text-[oklch(40%_0.015_250)] dark:text-[oklch(65%_0.01_250)] hover:bg-white/5 dark:hover:bg-white/[0.03]"`

    Wrap text labels in motion.span for fade-in on expand:
    ```tsx
    {!collapsed && (
      <motion.span
        className="truncate"
        initial={prefersReducedMotion ? false : { opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ duration: 0.15 }}
      >
        {item.name}
      </motion.span>
    )}
    ```

    Add `title={collapsed ? item.name : undefined}` on nav links for tooltip on hover (accessible).

    **Admin section separator:**
    Replace `border-t border-white/[0.06]` with:
    `"border-t border-[oklch(0%_0_0/0.08)] dark:border-[oklch(100%_0_0/0.06)]"`
    Label: `"text-[10px] uppercase tracking-wider text-[oklch(60%_0.01_250)] dark:text-[oklch(50%_0.01_250)] font-semibold"`

    **Timer Widget** — keep as-is, but wrap outer container in glass-card chip:
    ```tsx
    {!collapsed && (
      <div className="px-2 py-1">
        <div className="rounded-xl glass-card px-3 py-2">
          <TimerSidebarWidget />
        </div>
      </div>
    )}
    ```

    **Sidebar bottom (replaces old User/Logout section):**
    ```tsx
    <div className="border-t border-[oklch(0%_0_0/0.08)] dark:border-[oklch(100%_0_0/0.06)] p-2 space-y-1">
      {/* Dark mode toggle */}
      <button
        onClick={() => setTheme(resolvedTheme === "dark" ? "light" : "dark")}
        className="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-white/10 dark:hover:bg-white/5 transition-colors w-full"
        title={collapsed ? (resolvedTheme === "dark" ? "Hell" : "Dunkel") : undefined}
      >
        {resolvedTheme === "dark" ? (
          <Sun className="w-5 h-5 flex-shrink-0" />
        ) : (
          <Moon className="w-5 h-5 flex-shrink-0" />
        )}
        {!collapsed && (
          <motion.span
            className="text-sm truncate"
            initial={prefersReducedMotion ? false : { opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ duration: 0.15 }}
          >
            {resolvedTheme === "dark" ? "Heller Modus" : "Dunkler Modus"}
          </motion.span>
        )}
      </button>

      {/* Profile chip */}
      <div className="flex items-center gap-3 px-3 py-2.5 rounded-lg glass-card">
        <div className="flex-shrink-0 w-7 h-7 rounded-full bg-[oklch(45%_0.2_260)] flex items-center justify-center text-white text-xs font-semibold shadow-md">
          {session?.user?.name?.split(" ").map((n: string) => n[0]).join("").toUpperCase().slice(0, 2) ?? "?"}
        </div>
        {!collapsed && (
          <>
            <motion.div
              className="flex-1 min-w-0"
              initial={prefersReducedMotion ? false : { opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ duration: 0.15 }}
            >
              <p className="text-sm font-medium truncate">{session?.user?.name ?? "Benutzer"}</p>
            </motion.div>
            <button
              onClick={() => signOut({ callbackUrl: "/login" })}
              className="flex-shrink-0 p-1 rounded-md hover:bg-white/10 transition-colors"
              aria-label="Abmelden"
            >
              <LogOut className="w-4 h-4" />
            </button>
          </>
        )}
        {collapsed && (
          <button
            onClick={() => signOut({ callbackUrl: "/login" })}
            className="w-full flex justify-center"
            aria-label="Abmelden"
          >
            <LogOut className="w-4 h-4" />
          </button>
        )}
      </div>
    </div>
    ```

    Add `const { resolvedTheme, setTheme } = useTheme()` at top of component alongside existing hooks.
    Add `const prefersReducedMotion = useReducedMotion()` hook.
    Keep all existing filteredNavigation and role-based logic unchanged.
  </action>
  <verify>
    Visual: sidebar renders with transparent glass effect, gradient visible through it. Click collapse button → width animates smoothly (no jump). Dark mode toggle changes entire app theme. Profile chip shows user initials. Active nav item has blue left border.
  </verify>
  <done>Sidebar uses motion.aside with spring animation, glass-sidebar class, dark mode toggle with useTheme, profile chip, brand-blue active states. No TypeScript errors.</done>
</task>

<task type="auto">
  <name>Task 2: Upgrade header to glass-panel + update dashboard layout shell</name>
  <files>
    src/components/layout/header.tsx
    src/app/(dashboard)/layout.tsx
  </files>
  <action>
    **Update src/components/layout/header.tsx:**
    Replace `glass-heavy` class with explicit glass-panel styling. The header should be:
    - `sticky top-0 z-40` — stays at top when content scrolls
    - `glass-panel` — backdrop-blur 24px, correct glass tier
    - `border-b border-[var(--glass-border-color)]` — uses new token
    - `h-16 flex items-center justify-between px-6`

    Update the search button internal styling:
    - Background: `bg-white/40 dark:bg-white/[0.06]` (already close — keep)
    - Border: `border-[var(--glass-border-color)]`

    User avatar div: change `bg-brand-600` to `bg-[oklch(45%_0.2_260)]` (consistent with sidebar)

    The rest of header logic (NotificationBell, session user display) stays unchanged.

    **Update src/app/(dashboard)/layout.tsx:**
    In the outer wrapper div, remove `bg-mesh` class. The body gradient from Plan 01 handles the background — it is `background-attachment: fixed` so it stays fixed as a canvas.

    Change:
    ```tsx
    <div className="flex h-screen overflow-hidden bg-mesh">
    ```
    To:
    ```tsx
    <div className="flex h-screen overflow-hidden">
    ```

    The `<main>` element: add `bg-transparent` explicitly to ensure glass panels float directly on the gradient.

    Change:
    ```tsx
    <main className="flex-1 overflow-y-auto p-6">
    ```
    To:
    ```tsx
    <main className="flex-1 overflow-y-auto p-6 bg-transparent">
    ```
  </action>
  <verify>
    Load /dashboard in browser. Body gradient mesh is visible behind sidebar (glass blurs it). Header is visually frosted/glass. Scrolling main content does not scroll the background gradient. No layout shift or overflow issues.
  </verify>
  <done>Header uses glass-panel, sticky z-40. Dashboard layout removes bg-mesh. Gradient canvas visible through sidebar and header glass. No TypeScript errors.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — no errors in sidebar.tsx or header.tsx
2. Visual: gradient mesh visible through sidebar glass
3. Visual: collapse animation uses spring (smooth, slight overshoot)
4. Visual: dark mode toggle switches theme instantly + persists
5. Visual: header stays fixed at top on scroll
6. Visual: active nav item has brand-blue left border
</verification>

<success_criteria>
- Sidebar: glass-sidebar class, Motion spring width animation, dark mode toggle with useTheme, profile chip with initials + name + logout, active state brand-blue, admin section with oklch separator
- Header: glass-panel, sticky top-0 z-40, updated border token
- Dashboard layout: no bg-mesh on wrapper, transparent main, gradient canvas visible
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/11-glass-ui-migration/11-02-SUMMARY.md`
</output>
