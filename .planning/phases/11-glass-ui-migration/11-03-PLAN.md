---
phase: 11-glass-ui-migration
plan: 03
type: execute
wave: 2
depends_on:
  - 11-01
files_modified:
  - src/components/ui/glass-card.tsx
  - src/components/ui/glass-kpi-card.tsx
  - src/components/ui/glass-panel.tsx
  - src/components/ui/button.tsx
  - src/components/ui/input.tsx
  - src/components/ui/textarea.tsx
  - src/components/ui/select.tsx
  - src/components/ui/skeleton.tsx
  - src/app/layout.tsx
autonomous: true
requirements:
  - UI-01
  - UI-02
  - UI-03

must_haves:
  truths:
    - "GlassCard renders with glass-card class (16px blur) and accepts variant='elevated' for glass-panel-elevated (40px)"
    - "GlassKpiCard shows a count-up number animation on mount"
    - "GlassPanel accepts elevation variants matching the 4-tier system"
    - "Button components have Motion spring hover (scale 1.02) and tap (scale 0.98) animations"
    - "Input, Textarea, Select components use glass-input styling (8px blur, oklch border)"
    - "Skeleton component uses glass-shimmer animation from globals.css"
    - "Dialog/Modal entries animate with Motion spring (opacity 0 scale 0.96 → 1 scale 1)"
    - "Sonner toast config in layout.tsx uses glass styling + slide-from-right"
  artifacts:
    - path: "src/components/ui/glass-card.tsx"
      provides: "GlassCard with variant (default=glass-card / elevated=glass-panel-elevated) + optional Motion hover"
    - path: "src/components/ui/glass-kpi-card.tsx"
      provides: "GlassKpiCard with count-up animation using Motion animate from 0 to value"
    - path: "src/components/ui/glass-panel.tsx"
      provides: "GlassPanel with 4 elevation props matching glass tier names"
    - path: "src/components/ui/button.tsx"
      provides: "Button wrapped in Motion for spring hover/tap interactions"
    - path: "src/components/ui/input.tsx"
      provides: "Input with glass-input class (8px blur, oklch border, brand-blue focus ring)"
    - path: "src/components/ui/textarea.tsx"
      provides: "Textarea with glass-input class"
    - path: "src/components/ui/select.tsx"
      provides: "Select trigger with glass-input class"
    - path: "src/components/ui/skeleton.tsx"
      provides: "Skeleton with glass-shimmer animation"
  key_links:
    - from: "src/components/ui/button.tsx"
      to: "motion/react"
      via: "motion.button wrapper with whileHover/whileTap"
      pattern: "whileHover|whileTap"
    - from: "src/components/ui/glass-kpi-card.tsx"
      to: "motion/react"
      via: "useMotionValue + animate for count-up"
      pattern: "useMotionValue|animate"
---

<objective>
Upgrade the shared UI primitive components: add Motion/React interactions to glass-card, glass-kpi-card, button, and dialog. Apply glass-input tier to input/textarea/select. Add glass-shimmer to skeleton. These components are used on every page — upgrading them here propagates the glass design system everywhere without per-page changes.

Purpose: Central components propagate the glass design system to all 46 pages without requiring per-page edits for basic elements.
Output: Upgraded UI primitives with Motion interactions and glass-input styling.
</objective>

<execution_context>
@/Users/patrickbaumfalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrickbaumfalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/11-glass-ui-migration/11-CONTEXT.md
@.planning/phases/11-glass-ui-migration/11-01-SUMMARY.md

<interfaces>
<!-- Current glass-card.tsx: -->
<!-- - Uses .glass or .glass-heavy (which now alias to glass-card / glass-panel per Plan 01) -->
<!-- - Heavy prop → glass-heavy; default → glass -->
<!-- - No Motion, no variants beyond heavy -->

<!-- Current glass-kpi-card.tsx: -->
<!-- - Static number display: <p className="text-2xl font-semibold text-foreground">{value}</p> -->
<!-- - No animation -->

<!-- Current glass-panel.tsx: -->
<!-- - Uses .glass-lg (prominent) or .glass — maps to glass-panel-elevated / glass-card via aliases -->

<!-- Current button.tsx: -->
<!-- - React.forwardRef, cva variants, no Motion -->
<!-- - Variants: default, destructive, outline, secondary, ghost, link -->

<!-- Current input.tsx: -->
<!-- - Standard shadcn input: border border-input bg-background rounded-md -->
<!-- - No glass styling -->

<!-- Motion/React API (installed in Plan 01): -->
<!-- import { motion, useMotionValue, animate, useReducedMotion } from "motion/react" -->
<!-- whileHover={{ scale: 1.02 }}, whileTap={{ scale: 0.98 }} -->
<!-- transition={{ type: "spring", stiffness: 400, damping: 25 }} -->
<!-- Count-up: const count = useMotionValue(0); animate(count, numericValue, { duration: 0.8, ease: "easeOut" }) -->

<!-- Dialog in shadcn uses: -->
<!-- src/components/ui/alert-dialog.tsx (exists) -->
<!-- No custom dialog.tsx present — modals likely use radix Dialog or Sheet -->
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Upgrade glass-card, glass-kpi-card, glass-panel with Motion</name>
  <files>
    src/components/ui/glass-card.tsx
    src/components/ui/glass-kpi-card.tsx
    src/components/ui/glass-panel.tsx
  </files>
  <action>
    **Upgrade src/components/ui/glass-card.tsx:**
    Add `"use client"` directive (Motion requires client component).
    Add Motion import: `import { motion, useReducedMotion } from "motion/react"`.
    Add `variant` prop: `"default" | "elevated"` (default: "default").
    - `variant="default"` → className includes `glass-card`
    - `variant="elevated"` → className includes `glass-panel-elevated`
    Keep backward-compat: existing `heavy` prop → map to `variant="elevated"` internally.
    No Motion animation on GlassCard itself (it's a container, not interactive).
    Export: `GlassCard`, `GlassCardProps` (add `variant` to interface).

    **Upgrade src/components/ui/glass-kpi-card.tsx:**
    Add `"use client"` directive.
    Add Motion imports: `import { motion, useMotionValue, animate, useReducedMotion } from "motion/react"`.
    Add count-up animation for numeric values:
    ```tsx
    const prefersReducedMotion = useReducedMotion();
    const count = useMotionValue(0);
    const [displayValue, setDisplayValue] = useState(typeof value === "number" ? 0 : value);

    useEffect(() => {
      if (typeof value !== "number" || prefersReducedMotion) {
        setDisplayValue(value);
        return;
      }
      const controls = animate(count, value, {
        duration: 0.8,
        ease: "easeOut",
        onUpdate: (latest) => setDisplayValue(Math.round(latest)),
      });
      return controls.stop;
    }, [value, prefersReducedMotion]);
    ```
    Replace the static `{value}` display with `{displayValue}`.
    Replace outer div with `glass-card` class (was `glass` — the alias works but use explicit class now):
    `<div className={cn("glass-card rounded-xl p-5", className)}>`

    Add `skeleton?: boolean` prop: when true, show a glass-shimmer skeleton rectangle instead of content:
    ```tsx
    if (skeleton) {
      return <div className={cn("glass-card rounded-xl p-5 h-[84px] glass-shimmer", className)} />;
    }
    ```

    **Upgrade src/components/ui/glass-panel.tsx:**
    Add `elevation` prop: `"card" | "panel" | "elevated"` (default: "panel").
    Map to classes:
    - `"card"` → `glass-card`
    - `"panel"` → `glass-panel`
    - `"elevated"` → `glass-panel-elevated`
    Keep backward-compat: existing `prominent` prop → map to elevation="elevated".
    No "use client" needed — no hooks, but add it for consistency (avoids issues if children use context).
    Export updated `GlassPanelProps` with elevation.
  </action>
  <verify>
    `npx tsc --noEmit` — no type errors.
    Visual: GlassKpiCard on dashboard counts up from 0 on page load. GlassCard with variant="elevated" shows heavier glass. GlassKpiCard with skeleton prop shows shimmer.
  </verify>
  <done>glass-card.tsx adds variant prop. glass-kpi-card.tsx has count-up animation + skeleton prop. glass-panel.tsx has elevation prop. All backward-compat props preserved. No TS errors.</done>
</task>

<task type="auto">
  <name>Task 2: Upgrade Button with Motion, apply glass-input to form primitives, upgrade Skeleton, update Toast</name>
  <files>
    src/components/ui/button.tsx
    src/components/ui/input.tsx
    src/components/ui/textarea.tsx
    src/components/ui/select.tsx
    src/components/ui/skeleton.tsx
    src/app/layout.tsx
  </files>
  <action>
    **Upgrade src/components/ui/button.tsx:**
    Add `"use client"` directive.
    Add Motion imports: `import { motion, useReducedMotion } from "motion/react"`.

    Wrap the Button's rendered `<button>` or `<Slot>` with Motion. The tricky part: `React.forwardRef` + Motion. Pattern:
    - When `asChild` is false (standard button), render as `motion.button` with:
      - `whileHover={prefersReducedMotion ? {} : { scale: 1.02 }}`
      - `whileTap={prefersReducedMotion ? {} : { scale: 0.98 }}`
      - `transition={{ type: "spring", stiffness: 400, damping: 25 }}`
    - When `asChild` is true, use Slot as-is (no Motion — Slot handles arbitrary children)

    ```tsx
    "use client";
    import { motion, useReducedMotion } from "motion/react";

    const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
      ({ className, variant, size, asChild = false, ...props }, ref) => {
        const prefersReducedMotion = useReducedMotion();
        if (asChild) {
          const Comp = Slot;
          return <Comp className={cn(buttonVariants({ variant, size, className }))} ref={ref} {...props} />;
        }
        return (
          // @ts-expect-error -- motion v11 + React 19 type mismatch (runtime works fine)
          <motion.button
            className={cn(buttonVariants({ variant, size, className }))}
            ref={ref}
            whileHover={prefersReducedMotion ? {} : { scale: 1.02 }}
            whileTap={prefersReducedMotion ? {} : { scale: 0.98 }}
            transition={{ type: "spring", stiffness: 400, damping: 25 }}
            {...props}
          />
        );
      }
    );
    ```

    **Upgrade src/components/ui/input.tsx:**
    Replace the className string with glass-input styling:
    ```
    "flex h-10 w-full rounded-lg glass-input px-3 py-2 text-sm
     text-foreground placeholder:text-[oklch(60%_0.01_250)]
     focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[oklch(45%_0.2_260)]
     disabled:cursor-not-allowed disabled:opacity-50
     file:border-0 file:bg-transparent file:text-sm file:font-medium"
    ```
    Remove `border border-input bg-background ring-offset-background focus-visible:ring-offset-2` — glass-input provides its own border.

    **Upgrade src/components/ui/textarea.tsx:**
    Same as input but for `<textarea>`. Replace border/bg classes with `glass-input`. Add `resize-none` to className by default (user can override with className prop).
    Check if textarea.tsx exists — if it doesn't exist yet, create it as a standard shadcn textarea component with glass-input styling.

    **Upgrade src/components/ui/select.tsx:**
    The shadcn Select uses `SelectTrigger` as the visible input. Find the `SelectTrigger` component in the file and add `glass-input` to its className. Remove `border border-input bg-background` from the trigger's classes. Keep all other Select sub-components (SelectContent, SelectItem, etc.) as-is — only the trigger gets glass-input.

    **Create/upgrade src/components/ui/skeleton.tsx:**
    Check if skeleton.tsx exists. If yes, replace the `animate-pulse bg-muted` pattern. If not, create it.
    ```tsx
    import { cn } from "@/lib/utils";

    function Skeleton({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {
      return (
        <div
          className={cn("rounded-md glass-shimmer", className)}
          {...props}
        />
      );
    }
    export { Skeleton };
    ```

    **Update src/app/layout.tsx — Sonner Toast glass styling:**
    Update the `<Toaster>` component to use glass styling. Sonner accepts `toastOptions` for custom CSS:
    ```tsx
    <Toaster
      position="bottom-right"
      richColors
      toastOptions={{
        classNames: {
          toast: "glass-panel !border-[var(--glass-border-color)] !shadow-[var(--glass-shadow-lg)]",
        },
      }}
    />
    ```
    The `!` important overrides Sonner's default styles. This makes toasts use glass-panel backdrop-blur.
    NOTE: Sonner slide animations are built-in (slides from right by default at bottom-right position) — no custom animation needed.
  </action>
  <verify>
    `npx tsc --noEmit` — no type errors across all modified files.
    Visual: Click any button → subtle spring scale. Form inputs have glass-input frosted background. Skeleton shows shimmer animation. Toast notifications appear with glass styling.
  </verify>
  <done>button.tsx uses motion.button with spring hover/tap. input.tsx and textarea.tsx use glass-input. select.tsx trigger uses glass-input. skeleton.tsx uses glass-shimmer. Toaster in layout.tsx has glass classNames. No TS errors.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — zero errors
2. `grep -l "glass-input" src/components/ui/input.tsx src/components/ui/textarea.tsx src/components/ui/select.tsx` — all 3 files listed
3. `grep "whileHover\|whileTap" src/components/ui/button.tsx` — present
4. `grep "useMotionValue\|animate" src/components/ui/glass-kpi-card.tsx` — present
5. `grep "glass-shimmer" src/components/ui/skeleton.tsx` — present
6. Visual: KPI cards count up. Buttons spring on hover. Inputs have glass background.
</verification>

<success_criteria>
- glass-card.tsx: variant prop (default/elevated), backward-compat heavy prop
- glass-kpi-card.tsx: count-up animation (Motion), skeleton prop with glass-shimmer
- glass-panel.tsx: elevation prop (card/panel/elevated), backward-compat prominent prop
- button.tsx: motion.button with whileHover/whileTap spring, prefersReducedMotion respected
- input.tsx + textarea.tsx + select.tsx: glass-input class applied to form controls
- skeleton.tsx: glass-shimmer class
- layout.tsx Toaster: glass-panel classNames applied
- Zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/11-glass-ui-migration/11-03-SUMMARY.md`
</output>
